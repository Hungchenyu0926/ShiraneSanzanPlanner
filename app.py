import streamlit as st
import pandas as pd
import altair as alt

# è¨­å®šç¶²é æ¨™é¡Œèˆ‡æ’ç‰ˆ
st.set_page_config(
    page_title="ç™½å³°ä¸‰å±±ç¸±èµ°è¨ˆç•«",
    page_icon="ğŸ”ï¸",
    layout="wide"
)

# æ¨™é¡Œå€
st.title("ğŸ‡¯ğŸ‡µ å—é˜¿çˆ¾å‘æ–¯ï¼šç™½å³°ä¸‰å±±ç¸±èµ°è¨ˆç•«")
st.markdown("### åŒ—å²³ (3193m) â€¢ é–“ä¹‹å²³ (3190m) â€¢ è¾²é³¥å²³ (3026m)")

# å´é‚Šæ¬„ï¼šåŠŸèƒ½é¸å–®
menu = st.sidebar.radio(
    "åŠŸèƒ½é¸å–®",
    ["ğŸ“… è¡Œç¨‹è¦åŠƒ (4å¤©3å¤œ)", "ğŸ—ºï¸ å±±å€åœ°åœ–", "ğŸ“ˆ é«˜åº¦è®ŠåŒ–è¡¨", "ğŸ’ è£å‚™æª¢æŸ¥æ¸…å–®", "â˜ï¸ å¤©æ°£é å ±"]
)

# --- åŠŸèƒ½ 1: è¡Œç¨‹è¦åŠƒ ---
if menu == "ğŸ“… è¡Œç¨‹è¦åŠƒ (4å¤©3å¤œ)":
    st.header("æ¨è–¦è¡Œç¨‹ï¼š4å¤©3å¤œ (åŒ—é€²å—å‡º)")
    st.caption("æ­¤è¡Œç¨‹è¨­è¨ˆç‚ºè†è“‹å‹å–„ç‰ˆï¼Œå°‡ä¸‹å¡æ‹†è§£ï¼Œä¸¦ç›¡æƒ…äº«å—ç¨œç·šå¤§æ™¯ã€‚")
    
    col1, col2 = st.columns([1, 2])
    with col1:
        st.markdown("### Day 1: çˆ¬å‡æ—¥")
        st.success("ğŸ  å®¿ï¼šåŒ—å²³è‚©ä¹‹å°å±‹ (3000m)")
    with col2:
        st.write("""
        - **07:00** å»£æ²³åŸèµ·ç™» (1520m)
        - **10:00** ç™½æ ¹å¾¡æ± å°å±‹ (å¤§ä¼‘ã€è£œæ°´)
        - **13:00** è‰æ»‘å¡ (Kusa-suberi) é™¡ä¸Š
        - **15:00** æŠµé”è‚©ä¹‹å°å±‹ (Check-in, ä¼‘æ¯)
        """)
    st.divider()

    col3, col4 = st.columns([1, 2])
    with col3:
        st.markdown("### Day 2: ç¨œç·šæ—¥")
        st.success("ğŸ  å®¿ï¼šè¾²é³¥å°å±‹ (2800m)")
    with col4:
        st.write("""
        - **04:30** åŒ—å²³æ”»é ‚ (3193m) çœ‹æ—¥å‡º
        - **06:30** åŒ—å²³å±±èŠ (ç¶“éã€å¯è£œæ°´)
        - **10:00** é–“ä¹‹å²³ (3190m) æ—¥æœ¬ç¬¬ä¸‰é«˜å³°
        - **13:00** æŠµé”è¾²é³¥å°å±‹ (å‹™å¿…æ—©åˆ°ï¼Œè€é—†å¾ˆæœ‰å€‹æ€§)
        """)
    st.divider()

    col5, col6 = st.columns([1, 2])
    with col5:
        st.markdown("### Day 3: ä¸‹é™æ—¥")
        st.success("ğŸ  å®¿ï¼šå¤§é–€æ¾¤å°å±‹ (1700m)")
    with col6:
        st.write("""
        - **05:00** å‡ºç™¼
        - **06:30** è¾²é³¥å²³ (3026m)
        - **08:00** å¤§é–€æ¾¤ä¸‹é™é» (é–‹å§‹é™¡ä¸‹2000m)
        - **13:00** å¤§é–€æ¾¤å°å±‹ (æœ‰æºªæ°´ã€ç”Ÿå•¤é…’)
        """)
    st.divider()

    col7, col8 = st.columns([1, 2])
    with col7:
        st.markdown("### Day 4: æ­¸è³¦")
        st.success("â™¨ï¸ å¥ˆè‰¯ç”°æº«æ³‰")
    with col8:
        st.write("""
        - **06:00** æ‚ é–’å‡ºç™¼ï¼Œæ²¿æºªè°·æ—é“ä¸‹è¡Œ
        - **09:00** å¥ˆè‰¯ç”°ç™¼é›»æ‰€
        - **10:00** å¥ˆè‰¯ç”°ä¹‹é‡Œæº«æ³‰ (å¥³å¸ä¹‹æ¹¯)
        - **13:00** æ­å·´å£«å›èº«å»¶æˆ–ç”²åºœ
        """)

# --- åŠŸèƒ½ 2: å±±å€åœ°åœ– ---
elif menu == "ğŸ—ºï¸ å±±å€åœ°åœ–":
    st.header("ç™½å³°ä¸‰å±±è·¯ç·šåœ–")
    st.info("ğŸ’¡ é»æ“Šåœ–ç‰‡å³ä¸Šè§’çš„ç®­é ­å¯å…¨è¢å¹•æª¢è¦–ã€‚è«‹å‹™å¿…æ­é…é›¢ç·šåœ°åœ– APP (å¦‚ YAMAP) ä½¿ç”¨ã€‚")
    
    # å˜—è©¦è®€å–åœ–ç‰‡ï¼Œè‹¥ä½¿ç”¨è€…å¿˜è¨˜ä¸Šå‚³å‰‡é¡¯ç¤ºæç¤º
    try:
        st.image("map.jpg", caption="å—é˜¿çˆ¾å‘æ–¯ç™»å±±åœ°åœ– (ä¾†æºï¼šå±±èˆ‡é«˜åŸåœ°åœ–)", use_container_width=True)
    except:
        st.error("âš ï¸ å°šæœªæ‰¾åˆ°åœ°åœ–æª”æ¡ˆï¼è«‹ç¢ºèªæ‚¨å·²å°‡ 'map.jpg' ä¸Šå‚³è‡³ GitHub Repositoryã€‚")

# --- åŠŸèƒ½ 3: é«˜åº¦è®ŠåŒ–è¡¨ (å‡ç´šç‰ˆ) ---
elif menu == "ğŸ“ˆ é«˜åº¦è®ŠåŒ–è¡¨":
    st.header("é«˜åº¦å‰–é¢èˆ‡é‡è¦åœ°æ¨™")
    
    # å®šç¾©æ•¸æ“šé»ï¼ŒåŠ å…¥ Type ä¾†å€åˆ†é¡è‰²
    data = pd.DataFrame({
        'Location': ['å»£æ²³åŸ', 'ç™½æ ¹å¾¡æ± ', 'è‚©ä¹‹å°å±‹', 'åŒ—å²³', 'åŒ—å²³å±±èŠ', 'é–“ä¹‹å²³', 'è¾²é³¥å°å±‹', 'è¾²é³¥å²³', 'å¤§é–€æ¾¤ä¸‹é™é»', 'å¤§é–€æ¾¤å°å±‹', 'å¥ˆè‰¯ç”°'],
        'Distance': [0, 3.5, 6, 7, 8, 10, 12, 13, 13.5, 17, 22],
        'Elevation': [1520, 2230, 3000, 3193, 2900, 3190, 2800, 3026, 2800, 1700, 820],
        'Type': ['ç™»å±±å£', 'ä¼‘æ¯é»', 'å±±å±‹', 'å±±å³°', 'å±±å±‹', 'å±±å³°', 'å±±å±‹', 'å±±å³°', 'è·¯æ¨™', 'å±±å±‹', 'çµ‚é»'],
        'Label_Type': ['Normal', 'Normal', 'Hut', 'Peak', 'Hut', 'Peak', 'Hut', 'Peak', 'Normal', 'Hut', 'End']
    })

    # åŸºç¤ç·šåœ–
    line = alt.Chart(data).mark_line(color='gray', strokeWidth=3).encode(
        x=alt.X('Distance', title='ç´¯è¨ˆè·é›¢ (km)'),
        y=alt.Y('Elevation', title='æµ·æ‹” (m)', scale=alt.Scale(domain=[500, 3500]))
    )

    # é‡é»æ¨™ç¤ºé» (åªæœ‰å±±å³°å’Œå±±å±‹é¡¯ç¤ºå¤§é»)
    points = alt.Chart(data).mark_circle(size=100).encode(
        x='Distance',
        y='Elevation',
        color=alt.Color('Label_Type', 
                      scale=alt.Scale(domain=['Peak', 'Hut', 'Normal', 'End'], 
                                    range=['#FF4B4B', '#1E88E5', 'gray', 'green']),
                      legend=alt.Legend(title="åœ°æ¨™é¡å‹")),
        tooltip=['Location', 'Elevation', 'Type']
    )

    # æ–‡å­—æ¨™ç±¤ (é¡¯ç¤ºåœ°å)
    text = alt.Chart(data).mark_text(align='left', dx=10, dy=-10, fontSize=12).encode(
        x='Distance',
        y='Elevation',
        text='Location'
    )

    # çµ„åˆåœ–è¡¨
    chart = (line + points + text).interactive()
    st.altair_chart(chart, use_container_width=True)
    
    with st.expander("ğŸ“Š æŸ¥çœ‹è©³ç´°æµ·æ‹”æ•¸æ“šè¡¨"):
        st.dataframe(data[['Location', 'Elevation', 'Type', 'Distance']])

# --- åŠŸèƒ½ 4: è£å‚™æª¢æŸ¥æ¸…å–® (æ¥µè‡´è©³ç´°ç‰ˆ) ---
elif menu == "ğŸ’ è£å‚™æª¢æŸ¥æ¸…å–®":
    st.header("å—é˜¿çˆ¾å‘æ–¯ç¸±èµ°è£å‚™æ¸…å–®")
    st.warning("âš ï¸ æ­¤è·¯ç·šåŒ…å« 3000m ä»¥ä¸Šé«˜å±±èˆ‡å±éšªåœ°å½¢ï¼Œè«‹å‹™å¿…åš´æ ¼æª¢æŸ¥è£å‚™ã€‚")

    # å®šç¾©è©³ç´°åˆ†é¡å­—å…¸
    gear_dict = {
        "ğŸ ç³§é£Ÿé¡ (Food & Water)": [
            "è¡Œå‹•æ°´ (å»ºè­°ç¸½æ”œå¸¶é‡ 2-3L)",
            "ä¿æº«ç“¶ (æ¸…æ™¨æ”»é ‚å–ç†±æ°´æ¥µé‡è¦)",
            "æ—©é¤ (éºµåŒ…/é£¯ç³° - 3å¤©ä»½)",
            "åˆé¤ (è¡Œå‹•ç³§/èƒ½é‡æ£’/éºµåŒ… - 4å¤©ä»½)",
            "æ™šé¤ (è‹¥ä¸è¨‚å±±å±‹é¤ï¼Œéœ€å‚™ä¹¾ç‡¥é£¯/æ³¡éºµ)",
            "å‚™ç”¨ç³§ (å¤šæº–å‚™åŠå¤©ä»½ä»¥é˜²å—å›°)",
            "é¹½ç³–/é›»è§£è³ªç²‰ (é é˜²æŠ½ç­‹)",
            "æ¿¾æ°´å™¨ (é¸ç”¨ï¼Œå¤§é–€æ¾¤æºªæ°´å»ºè­°éæ¿¾)"
        ],
        "ğŸ§¥ è¡£æœé¡ (Clothing)": [
            "æ’æ±—åº•å±¤è¡£ (ç¾Šæ¯›æˆ–åŒ–çº–ï¼Œç¦æ£‰è³ª)",
            "ä¿æš–ä¸­å±¤ (ç¾½çµ¨è¡£æˆ–åŒ–çº–å¤–å¥—ï¼Œç¨œç·šæ¥µå†·)",
            "é˜²é¢¨é˜²æ°´å¤–å¥— (Gore-texç­‰ç´šï¼Œç¡¬æ®¼)",
            "ç™»å±±è¤² (è€ç£¨ã€å½ˆæ€§)",
            "å‚™ç”¨è¥ªå­ (ç¾Šæ¯›è¥ªï¼Œè‡³å°‘1-2é›™)",
            "ä¿æš–æ¯›å¸½ (é‡è¦ï¼é ­éƒ¨ä¿æš–)",
            "é®é™½å¸½/åœ“ç›¤å¸½",
            "é ˜å·¾/é­”è¡“é ­å·¾ (é˜²æ›¬é˜²é¢¨)",
            "é›¨è¤² (å¿…å‚™ï¼Œæ—¥æœ¬åˆå¾Œé›·é›¨å¾ˆå¤§)"
        ],
        "ğŸªœ æŠ€è¡“èˆ‡ç™»å±±è£å‚™ (Technical Gear)": [
            "ç™»å±±èƒŒåŒ… (45-60L)",
            "èƒŒåŒ…å¥— (é˜²é›¨)",
            "ç™»å±±é‹ (é«˜ç­’ï¼Œå»ºè­°é˜²æ°´)",
            "å²©ç›” (Helmet) - åŒ—å²³å…«æœ¬é½’è·¯æ®µè½çŸ³å¤šï¼Œå¼·çƒˆå»ºè­°",
            "ç™»å±±æ– (å»ºè­°ä¸€å°ï¼Œä¿è­·è†è“‹)",
            "è­·è† (ä¸‹å¤§é–€æ¾¤éå¸¸é™¡ï¼Œå¼·çƒˆå»ºè­°)",
            "ç¶è…¿ (é¸ç”¨ï¼Œé˜²ç ‚çŸ³é€²å…¥é‹å…§)"
        ],
        "ğŸ”¦ å¿…è¦èˆ‡é›»å­è£å‚™ (Essentials)": [
            "é ­ç‡ˆ (Headlamp) + å‚™ç”¨é›»æ± ",
            "é›¢ç·šåœ°åœ– APP (å·²ä¸‹è¼‰åœ–è³‡)",
            "è¡Œå‹•é›»æº (20000mAh ç‚ºä½³)",
            "å……é›»ç·š (Type-C / Lightning)",
            "ç¾é‡‘ (æ—¥å¹£åƒå…ƒéˆ”10å¼µä»¥ä¸Šï¼Œç™¾å…ƒç¡¬å¹£20æš - ä¸Šå»æ‰€ç”¨)",
            "æ‰‹æ©Ÿé˜²æ°´è¢‹",
            "å€‹äººè­‰ä»¶ / å¥ä¿å¡ / å…¥å±±éšªè­‰æ˜"
        ],
        "â›º ä½å®¿èˆ‡ç¡çœ  (Accommodation)": [
            "è€³å¡ (å±±å±‹æ‰“å‘¼è²å¾ˆå¤§)",
            "çœ¼ç½© (é¸ç”¨)",
            "å…§å‹™è¢‹/å¡‘è† è¢‹ (å±±å±‹åƒåœ¾éœ€è‡ªè¡Œå¸¶ä¸‹å±±)",
            "æ¿•ç´™å·¾ (å±±å±‹é€šå¸¸ç„¡æ³•æ´—æ¾¡)",
            "ç‰™åˆ·/ç‰™è† (éƒ¨åˆ†å±±å±‹ç¦ç”¨ç‰™è†ï¼Œè«‹ç•™æ„)",
            "æ—…è¡Œæ•é ­ (é¸ç”¨)"
        ],
        "ğŸ’Š æ€¥æ•‘èˆ‡å…¶ä»– (First Aid & Others)": [
            "å€‹äººå¸¸å‚™è—¥ (é«˜å±±ç—‡è—¥/æ­¢ç—›è—¥/èƒƒè—¥)",
            "å¤–å‚·è—¥ (OKç¹ƒ/å„ªç¢˜)",
            "é˜²æ›¬ä¹³ (é«˜æµ·æ‹”ç´«å¤–ç·šæ¥µå¼·)",
            "è­·å”‡è†",
            "è¡›ç”Ÿç´™ (å¯æº¶æ–¼æ°´è€…ä½³)",
            "æ±‚ç”Ÿæ¯¯ (ç·Šæ€¥éœ²å®¿ç”¨)"
        ]
    }

    # ç”¢ç”Ÿæª¢æŸ¥è¡¨
    total_items = 0
    checked_count = 0

    for category, items in gear_dict.items():
        with st.expander(category, expanded=True):
            for item in items:
                total_items += 1
                if st.checkbox(item, key=item):
                    checked_count += 1
    
    # é€²åº¦æ¢é¡¯ç¤º
    st.divider()
    if total_items > 0:
        progress = checked_count / total_items
        st.write(f"### æº–å‚™é€²åº¦ï¼š{int(progress*100)}% ({checked_count}/{total_items})")
        st.progress(progress)
        if progress == 1.0:
            st.balloons()
            st.success("å¤ªæ£’äº†ï¼è£å‚™å·²å…¨æ•¸é½Šå…¨ï¼Œæº–å‚™å‡ºç™¼ï¼")

# --- åŠŸèƒ½ 5: å¤©æ°£é å ± ---
elif menu == "â˜ï¸ å¤©æ°£é å ±":
    st.header("ğŸ”ï¸ ç™½å³°ä¸‰å±±ï¼šé«˜å±±æ°£è±¡ç«™")
    st.info("ğŸ’¡ ç™»å±±æŒ‡æ•¸èªªæ˜ (Tenki.jp)ï¼šA=é©åˆï¼ŒB=é¢¨é›¨ç¨å¼·ï¼ŒC=å¼·é¢¨è±ªé›¨ä¸å®œå‰å¾€ã€‚")
    
    tab1, tab2, tab3 = st.tabs(["åŒ—å²³ (3193m)", "é–“ä¹‹å²³ (3190m)", "è¾²é³¥å²³ (3026m)"])
    
    with tab1:
        col1, col2 = st.columns(2)
        with col1:
            st.markdown("##### ğŸ‡¯ğŸ‡µ Tenki.jp (åŒ—å²³)")
            st.link_button("æŸ¥çœ‹è©³ç´°é å ±", "https://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=19150004&type=15&ba=kk")
        with col2:
            st.markdown("##### ğŸŒ Mountain Forecast")
            st.link_button("æŸ¥çœ‹é¢¨é€Ÿé«”æ„Ÿ", "https://www.mountain-forecast.com/peaks/Kita-dake/forecasts/3193")

    with tab2:
        col1, col2 = st.columns(2)
        with col1:
            st.markdown("##### ğŸ‡¯ğŸ‡µ Tenki.jp (é–“ä¹‹å²³)")
            st.link_button("æŸ¥çœ‹è©³ç´°é å ±", "https://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=20150025&type=15&ba=kk")
        with col2:
            st.markdown("##### ğŸŒ Mountain Forecast")
            st.link_button("æŸ¥çœ‹é¢¨é€Ÿé«”æ„Ÿ", "https://www.mountain-forecast.com/peaks/Aino-dake/forecasts/3189")

    with tab3:
        col1, col2 = st.columns(2)
        with col1:
            st.markdown("##### ğŸ‡¯ğŸ‡µ Tenki.jp (è¾²é³¥å²³)")
            st.link_button("æŸ¥çœ‹è©³ç´°é å ±", "https://tenkura.n-kishou.co.jp/tk/kanko/kad.html?code=19150026&type=15&ba=kk")
        with col2:
            st.markdown("##### ğŸŒ Mountain Forecast")
            st.link_button("æŸ¥çœ‹é¢¨é€Ÿé«”æ„Ÿ", "https://www.mountain-forecast.com/peaks/Notori-dake/forecasts/3026")

    st.warning("âš ï¸ è¾²é³¥å²³åˆå¾Œæ˜“èµ·éœ§ï¼Œè«‹ç›¡é‡æ–¼ä¸­åˆå‰é€šéç¨œç·šã€‚")
